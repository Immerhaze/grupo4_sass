generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")   // Neon pooled (runtime)
  directUrl = env("DIRECT_URL")     // Neon direct (migrations)
}

enum InstitutionStatus {
  draft
  active
  suspended
}

enum UserRole {
  ADMINISTRATIVE
  TEACHER
  STUDENT
}

model Institution {
   id           String     @id @default(uuid()) @db.Uuid
  name         String
  domainSlug   String?    @unique
  contactEmail String?
  status       InstitutionStatus @default(draft)
  trialEndsAt  DateTime?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  // üîΩ Nuevo campo: qui√©n cre√≥ esta instituci√≥n (ID de Neon Auth)
  createdByAuthUserId String?   // authUserId de Neon Auth

  appUsers     AppUser[]
}

model AppUser {
  id            String       @id @default(uuid()) @db.Uuid

  /// ID del usuario en Neon Auth (neon_auth.users_sync.id)
  authUserId    String?      @unique   

  email         String?
  fullName      String?
  role          UserRole

  institutionId String?      @db.Uuid
  institution   Institution? @relation(fields: [institutionId], references: [id])

  isActive      Boolean      @default(true)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
}
